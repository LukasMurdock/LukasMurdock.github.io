<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SQL Test</title>
  <meta name="description" content="Getting better at SQL through trial and error"}}>
  <link rel='canonical' href="http://localhost:4000/sqltest/">
  <link rel="stylesheet" type="text/css" href="/css/main.css" />
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
  <meta name="google-site-verification" content="fPk8VHNqhVzOb2qHw5K0bg3w8WrInKiLQeqZBOteVFA" />
</head>



<body>

  <!-- Google Analytics Code -->
  <body class="pagebody">
  <nav class="nav-menu">
    <a href="/">Home</a>
    <a href="/about">About</a>
    <a href="/updates">Updates</a>
    <a href="/contact">Contact</a>
  </nav>
</body>
<hr>

<div id="bottomnav" class="bottomnav">

  <div class="logo">
      <a href="/" aria-label="Home"><svg class="icon" width="42px" height="42px" viewBox="0 0 1000 1000" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><path d="M523.761,600.435l-0.031,49.829l0,0.003c0,26.496 -10.525,51.906 -29.261,70.641c-18.735,18.736 -44.145,29.261 -70.641,29.261l-0.196,0c-26.496,0 -51.906,-10.525 -70.641,-29.261c-18.736,-18.735 -29.261,-44.145 -29.261,-70.641l0,-0.003c0,-26.496 10.525,-51.906 29.261,-70.641c18.735,-18.736 44.145,-29.261 70.641,-29.261l0.196,0c1.673,0 50.952,0.126 50.952,0.126l0.063,-100.585l-1.291,0c0,0 0,0 0,0c-55.228,0 -100,-44.771 -100,-99.999l0,-0.001l50.001,0c0.096,27.632 22.524,50 50.177,50l1.144,0l0.032,-50.167l0,-0.003c0,-26.496 10.525,-51.906 29.26,-70.641c18.736,-18.736 44.146,-29.261 70.642,-29.261l0.196,0c26.496,0 51.906,10.525 70.641,29.261c18.735,18.735 29.261,44.145 29.261,70.641l0,0.003c0,26.496 -10.526,51.906 -29.261,70.641c-18.735,18.736 -44.145,29.261 -70.641,29.261l-0.196,0c-1.673,0 -50.952,-0.126 -50.952,-0.126l-0.063,100.621c24.513,0.128 60.8,0.302 76.586,0.302c27.653,0 50.081,-22.37 50.177,-50l50,0c0,0 0,0 0,0c0,55.228 -44.771,100 -100,100c0,0 0,0 0,0l-76.795,0Zm-100.031,99.782c13.262,0 25.979,-5.268 35.355,-14.644c9.377,-9.377 14.645,-22.095 14.645,-35.356l0,-49.903l-50.05,0c-13.247,0 -25.952,5.262 -35.32,14.63c-9.367,9.367 -14.63,22.072 -14.63,35.32c0,0.001 0,0.002 0,0.003c0,13.248 5.263,25.953 14.63,35.32c9.368,9.368 22.073,14.63 35.32,14.63l0.05,0Zm101.176,-350.434c0,-13.261 5.268,-25.979 14.645,-35.356c9.376,-9.377 22.094,-14.644 35.355,-14.644l0.05,0c13.247,0 25.952,5.262 35.32,14.63c9.367,9.367 14.63,22.072 14.63,35.32c0,0.001 0,0.002 0,0.003c0,13.248 -5.263,25.953 -14.63,35.32c-9.368,9.368 -22.073,14.63 -35.32,14.63l-50.05,0l0,-49.903Z"/></svg></a>
  </div>
  <div class="sandwich" onclick="menuOpen(this)">
      <div class="bottom-nav">
          <div class="topbar"></div>
          <div class="bottombar"></div>
      </div>
  </div>
  <div id="menu" class="menu">
      <a href="/resources" class="bottomnav_link">Resources</a>
      <a href="/updates" class="bottomnav_link">Updates</a>
      <a href="/about" class="bottomnav_link">About</a>
      <a href="/contact" class="bottomnav_link">Contact</a>
      
  </div>

</div>

<script>
  function menuOpen(x) {
    document.getElementById("bottomnav").classList.toggle('menu_open');
    x.classList.toggle("menu_cross");
  }
</script>

  
    <h1 class="hero-headline">SQL Test</h1>
  

    <style>
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #008000 } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #0000ff } /* Keyword */
.highlight .cm { color: #008000 } /* Comment.Multiline */
.highlight .cp { color: #0000ff } /* Comment.Preproc */
.highlight .c1 { color: #008000 } /* Comment.Single */
.highlight .cs { color: #008000 } /* Comment.Special */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gh { font-weight: bold } /* Generic.Heading */
.highlight .gp { font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { font-weight: bold } /* Generic.Subheading */
.highlight .kc { color: #0000ff } /* Keyword.Constant */
.highlight .kd { color: #0000ff } /* Keyword.Declaration */
.highlight .kn { color: #0000ff } /* Keyword.Namespace */
.highlight .kp { color: #0000ff } /* Keyword.Pseudo */
.highlight .kr { color: #0000ff } /* Keyword.Reserved */
.highlight .kt { color: #2b91af } /* Keyword.Type */
.highlight .s { color: #a31515 } /* Literal.String */
.highlight .nc { color: #2b91af } /* Name.Class */
.highlight .ow { color: #0000ff } /* Operator.Word */
.highlight .sb { color: #a31515 } /* Literal.String.Backtick */
.highlight .sc { color: #a31515 } /* Literal.String.Char */
.highlight .sd { color: #a31515 } /* Literal.String.Doc */
.highlight .s2 { color: #a31515 } /* Literal.String.Double */
.highlight .se { color: #a31515 } /* Literal.String.Escape */
.highlight .sh { color: #a31515 } /* Literal.String.Heredoc */
.highlight .si { color: #a31515 } /* Literal.String.Interpol */
.highlight .sx { color: #a31515 } /* Literal.String.Other */
.highlight .sr { color: #a31515 } /* Literal.String.Regex */
.highlight .s1 { color: #a31515 } /* Literal.String.Single */
.highlight .ss { color: #a31515 } /* Literal.String.Symbol */

.highlight {
    background-color: #ddd;
    padding:20px;
}

@import url('https://fonts.googleapis.com/css?family=Fira+Code&display=swap');
pre {
  white-space: pre;
  overflow: auto;
  font-size:13px;
  line-height: 1.3;
  }
/*
code{
  font-family: 'Fira Code', monospace;
}
*/



  h1{
    text-align: center;
  }

  h3{
    font-size: 22px;
    padding-left: 20px;
  }
  img {
    width: 16px;
    height: 16px;
    margin-right: 4px;
    margin-top: 2px;
    float: left;
  }

  td:first-child {
    border-right: 2px solid #d9d9d9;
    padding-right: 4px;
  }

  td:nth-child(2), th:nth-child(2){
    padding-left: 4px;
  }

  table {
    table-layout: auto;
    width: 100%;
    border-spacing: 0px;
  }

  th, td {
    border-bottom: 2px solid #d9d9d9;
    text-align: left;
  }

  @media screen and (max-width: 735px) {
    .grid-container {
      grid-template-columns: repeat(1, 1fr);
    }
    h1{
      font-size: 44px!important;
      padding-bottom: 44px;
    }
    h2{
      padding: 0;
      margin:0;
    }
}
</style>
<div class="pagebody-content">
  <h2>Getting better at SQL through trial and error</h2>
  <p>Ok so in an attempt to get better at SQL I wanted to find a result I wanted from the data and work out how to get it in SQL. </p>
  <p>I decided to try to find out how the amount of profit each supplier is currently bringing in.</p>
  <p>To do this I would need to find the products sold by each supplier and the profit of those item by subtracting the UNITCOST by the UNITPRICE and then multiply that by the amount of units ordered.</p>
  <figure class="highlight"><pre><code class="language-sql" data-lang="sql">  <span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">)</span></code></pre></figure>
  <p>Seems simple enough…</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
<span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span> <span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span><span class="p">;</span></code></pre></figure>

  <table>
      <tr>
        <th valign="bottom">Company</th>
        <th valign="bottom">Current Item Profit</th>
      </tr>
      <tr>
        <td>Exotic Liquids</td>
        <td>0</td>
     </tr>
     <tr>
        <td>Exotic Liquids</td>
        <td>126.8</td>
     </tr>
     <tr>
        <td>Exotic Liquids</td>
        <td>39.9</td>
     </tr>
</table><span style="font-size:13px;"><i>Note: I'm only showing the results for the first company to reduce table size.</i></span><br>
<p>Ah okay now we need to get the sum of the units by each company…</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
<span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span> <span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">companyname</span><span class="p">;</span></code></pre></figure>

<p><i><u>Error:</u> “not a GROUP BY expression”</i></p>
<p>Well shit.<br>After trying a bunch of things, I finally got something to work.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">currentordertotal</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ORDERPROFIT</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="p">(</span><span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">))</span>
  <span class="k">AS</span> <span class="n">CURRENTORDERTOTAL</span> <span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
  <span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span>
  <span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span>
  <span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">companyname</span><span class="p">;</span></code></pre></figure>

<table>
    <tr>
      <th valign="bottom">Company</th>
      <th valign="bottom">Current Order Profit</th>
    </tr>
   <tr>
      <td>Exotic Liquids</td>
      <td>166.7</td>
   </tr>
</table><span style="font-size:13px;"><i>Note: I'm only showing the results for one company to reduce table size.</i></span><br>
<p>And while that awkward nesting works… after a little more tinkering I realized this is what it really should be.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">))</span>
<span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
<span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span>
<span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">companyname</span><span class="p">;</span></code></pre></figure>
<p>Much cleaner to read and execute.<br>Now we can sort the output by adding this:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">))</span>
<span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
<span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span>
<span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">companyname</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">SUM</span><span class="p">(</span><span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">))</span> <span class="k">DESC</span><span class="p">;</span></code></pre></figure>

<p>Now let's clean up the column names...</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">companyname</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">unitsonorder</span> <span class="o">*</span> <span class="p">(</span><span class="n">unitprice</span> <span class="o">-</span> <span class="n">unitcost</span><span class="p">))</span>
<span class="k">AS</span> <span class="n">ORDERPROFIT</span>
<span class="k">FROM</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">products</span>
<span class="k">JOIN</span> <span class="n">northwinds</span><span class="p">.</span><span class="n">suppliers</span>
<span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">supplierid</span> <span class="o">=</span> <span class="n">suppliers</span><span class="p">.</span><span class="n">supplierid</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">companyname</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">orderprofit</span> <span class="k">DESC</span><span class="p">;</span></code></pre></figure>

<p>And that's it! Successfully calculated all supplier current order profits.<br>You can paste the above code into FSBoracle and see the values.</p>
</div>



    <footer>
  <a href='https://instagram.com/lukasauras.rex' target='_blank' rel="noreferrer" aria-label="instagram account link">
    <svg viewBox="0 0 24 24">
      <path fill="#0070c9" d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" />
    </svg>
  </a>

  <a style="margin-left:20px;" href='https://www.twitter.com/Lukasauras_Rex' target='_blank' rel="noreferrer" aria-label="twitter account link">
    <svg viewBox="0 0 24 24">
      <path fill="#0070c9" d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" />
    </svg>
  </a>

  <a style="margin-left:20px;" href='https://www.linkedin.com/in/lukas-murdock' target='_blank' rel="noreferrer" aria-label="twitter account link">
    <svg viewBox="0 0 24 24">
      <path fill="#0070c9" d="M21,21H17V14.25C17,13.19 15.81,12.31 14.75,12.31C13.69,12.31 13,13.19 13,14.25V21H9V9H13V11C13.66,9.93 15.36,9.24 16.5,9.24C19,9.24 21,11.28 21,13.75V21M7,21H3V9H7V21M5,3A2,2 0 0,1 7,5A2,2 0 0,1 5,7A2,2 0 0,1 3,5A2,2 0 0,1 5,3Z" />
    </svg>
  </a>
  <a style="font-size: 17px; margin-left:20px;" href="/resources"><span>View resources</span></a>
  <p>&copy; 2019 Lukas Murdock</p>
</footer>
  </div>


  <script src="/js/masonry.pkgd.min.js">            </script>
  <script src="/js/imagesloaded.pkgd.min.js">       </script>
  <script src="/js/evil-icons.min.js">              </script>
</body>

</html>